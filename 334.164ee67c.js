"use strict";(self["webpackChunkvue2_pc_project"]=self["webpackChunkvue2_pc_project"]||[]).push([[334],{4334:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"box"},[t("div",{staticClass:"main-content"},[t("div",{staticClass:"one",on:{click:e.goBack}},[e._v("返回课程")]),t("div",{staticClass:"two"},[t("div",{staticClass:"zuo"},[t("div",{staticClass:"progress-mask",on:{click:e.handleProgressClick}}),t("video",{ref:"videoPlayer",attrs:{controls:"","initial-time":e.initial_time,src:e.Imgurl+e.infoData.videoUrl,poster:e.Imgurl+e.infoData.classImg,autoplay:"",muted:"",controlsList:"nodownload noplaybackrate"},domProps:{muted:!0},on:{timeupdate:e.handleTimeUpdate,loadedmetadata:e.handleLoadedMetadata,pause:e.handlePause,ended:e.handleVideoEnded,play:e.handlePlay,fullscreenchange:e.handleFullscreenChange,seeking:e.handleSeeking}})]),t("div",{staticStyle:{height:"50.25rem","overflow-y":"auto"}},e._l(e.Data,(function(i,n){return t("div",{key:n,staticClass:"you",class:{"active-item":e.selectedIndex===n},on:{click:function(t){return e.selectItem(i,n)}}},[t("div",{staticClass:"you-yi"},[t("div",{staticClass:"you-er"},[t("img",{attrs:{src:s(5845)}}),t("div",{staticClass:"you-san"},[t("span",[e._v(e._s(i.className))]),t("span",[e._v("时长："+e._s(i.videoDuration)+"分钟")])])]),t("div",{staticClass:"you-si",style:{color:e.selectedIndex===n?"":"Y"===i.finishFlag?"#E50E0B":null==i.finishFlag?"#666666":""}},[e._v(" "+e._s(e.selectedIndex===n?"正在学":"Y"===i.finishFlag?"已学完":null==i.finishFlag?"未学习":"正在学")+" ")])])])})),0)])]),t("el-dialog",{attrs:{visible:e.showPopup,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},on:{"update:visible":function(t){e.showPopup=t}}},[t("div",{staticClass:"bt"},[e._v("提示")]),t("div",{staticClass:"yz"},[t("div",{staticClass:"yz-yi"},[t("el-input",{attrs:{placeholder:"请输入验证码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.checkCode.apply(null,arguments)}},model:{value:e.userInput,callback:function(t){e.userInput=t},expression:"userInput"}})],1),t("div",{staticClass:"yz-er",on:{click:e.refreshCode}},[e._v(e._s(e.verificationCode))])])])],1)},n=[],a=s(5200),r={data(){return{videoSrc:"",lastPlayedTime:0,hasShownWarning:!1,isUserInteraction:!1,videoDuration:0,pausePoints:[2,10,15],currentPauseIndex:0,isPaused:!1,showPopup:!1,userInput:"",verificationCode:this.generateCode(),Data:[],selectedIndex:0,infoData:{},Imgurl:"https://ykt.hngks.com/prod-api",classCategoryId:"",pausedTime:"",playTime:"",playPercentage:0,enablePopstateListener:!0,itemData:{},classId:"",isSubmitting:!1,initial_time:0,isInitialSeek:!0}},created(){const e=JSON.parse(this.$route.query.itemData);this.itemData=e,this.classCategoryId=this.itemData.classCategoryId,this.classId=this.itemData.classId,this.getClassList()},mounted(){const e=this.$refs.videoPlayer;e.addEventListener("contextmenu",(e=>e.preventDefault())),e.addEventListener("keydown",(e=>{[32,37,39].includes(e.keyCode)&&e.preventDefault()})),this.disableNativeProgressBar(),this.checkInterval=setInterval((()=>{Math.abs(e.currentTime-this.lastPlayedTime)>.5&&(e.currentTime=this.lastPlayedTime)}),500),window.addEventListener("popstate",this.handleBrowserBack),this.$nextTick((()=>{const t=e.play();void 0!==t&&t.catch((e=>{console.log("自动播放被阻止:",e)}))}))},beforeDestroy(){window.removeEventListener("popstate",this.handleBrowserBack),clearInterval(this.checkInterval)},beforeRouteLeave(e,t,s){if(this.isSubmitting)return s(!1);if(""!==this.pausedTime||!isNaN(this.playPercentage)&&null!==this.playPercentage){this.isSubmitting=!0;const e={classId:this.classId,playTime:this.pausedTime||this.playTime,playPersent:parseFloat((this.playPercentage/100).toFixed(2))};(0,a.sC)(e).then((e=>{200==e.code?(this.$message.success("提交成功！"),s()):this.$message.error(e.msg),s()})).catch((e=>{this.$message.error("提交失败"),s(!1)})).finally((()=>{this.isSubmitting=!1}))}else s()},methods:{showConfirmDialog(){return new Promise(((e,t)=>{this.$confirm("确定要离开当前页面吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(e).catch(t)}))},goBack(){if(""!==this.pausedTime||!isNaN(this.playPercentage)&&null!==this.playPercentage&&void 0!==this.playPercentage){const e={classId:this.classId,playTime:this.pausedTime||this.playTime,playPersent:parseFloat((this.playPercentage/100).toFixed(2))};(0,a.sC)(e).then((e=>{200==e.code?(this.$router.replace("/home"),this.$message.success("提交本次学习进度成功！！")):this.$message.error(e.msg)}))}else this.$router.replace("/home")},getClassList(){const e={classCategoryId:this.classCategoryId};(0,a.pP)(e).then((e=>{if(200==e.code){this.Data=e.rows;const t=e.rows.findIndex((e=>e.classId===this.itemData.classId));if(-1!==t){this.selectedIndex=t,this.infoData=e.rows[t];const s=Number(e.rows[t].playTime);1==e.rows[t].playPersent?this.initial_time=0:this.initial_time=s}else{this.selectedIndex=0,this.infoData=e.rows[0];const t=Number(e.rows[0].playTime);1==e.rows[0].playPersent?this.initial_time=0:this.initial_time=t}}else this.$message.error(e.msg)}))},selectItem(e,t){this.selectedIndex=t,this.classId=e.classId,this.infoData=e,this.initial_time=Number(e.playTime);const s={classId:this.itemData.classId,playTime:this.pausedTime||this.playTime,playPersent:parseFloat((this.playPercentage/100).toFixed(2))};(0,a.sC)(s).then((t=>{if(200==t.code){const t={classCategoryId:this.classCategoryId};(0,a.pP)(t).then((e=>{if(200==e.code){this.Data=e.rows;const t=e.rows.findIndex((e=>e.classId===this.infoData.classId));if(console.log(t,"foundIndex"),-1!==t){this.selectedIndex=t,this.infoData=e.rows[t];const s=Number(e.rows[t].playTime);1==e.rows[t].playPersent?this.initial_time=0:this.initial_time=s}else{this.selectedIndex=0,this.infoData=e.rows[0];const t=Number(e.rows[0].playTime);1==e.rows[0].playPersent?this.initial_time=0:this.initial_time=t}}else this.$message.error(e.msg)})),this.itemData.classId=e.classId,this.$message.success("提交本次学习进度成功！！")}else this.$message.error(t.msg)}))},generateCode(){const e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";let t="";for(let s=0;s<4;s++){const s=Math.floor(Math.random()*e.length);t+=e[s]}return t},refreshCode(){this.verificationCode=this.generateCode(),this.userInput=""},checkCode(){this.userInput.toUpperCase()===this.verificationCode?(this.handlePopupConfirm(),this.$message.success("验证成功！")):(this.$message.error("验证码错误，请重新输入！"),this.refreshCode())},handleLoadedMetadata(){const e=this.$refs.videoPlayer;this.videoDuration=e.duration,this.isInitialSeek=!0,e.currentTime=this.initial_time,this.lastPlayedTime=this.initial_time,this.infoData&&"Y"===this.infoData.verifyFlag?this.generateRandomPausePoints():this.pausePoints=[],setTimeout((()=>{this.isInitialSeek=!1}),300)},generateRandomPausePoints(){const e=this.videoDuration;if(e<=0)return;const t=e-5;if(t<=0)return;const s=[];for(let i=0;i<3;i++){const e=Math.floor(Math.random()*t)+1;s.push(e)}s.sort(((e,t)=>e-t));for(let i=1;i<s.length;i++)s[i]-s[i-1]<3&&(s[i]=s[i-1]+3);this.pausePoints=s,console.log("生成的随机暂停点:",this.pausePoints)},disableNativeProgressBar(){const e=this.$refs.videoPlayer;setTimeout((()=>{const t=e.querySelector('input[type="range"]');t&&(t.style.pointerEvents="none",t.style.opacity="0.5",t.title="进度条已禁用")}),1e3)},handleProgressClick(e){this.hasShownWarning||(this.$message.warning("课程按顺序学习，不支持跳转"),this.hasShownWarning=!0,setTimeout((()=>this.hasShownWarning=!1),3e3)),e.stopPropagation()},handlePlay(){this.$refs.videoPlayer.muted=!1},handleTimeUpdate(){if(!this.isUserInteraction){this.lastPlayedTime=this.$refs.videoPlayer.currentTime;this.$refs.videoPlayer.currentTime;this.playTime=Math.floor(this.$refs.videoPlayer.currentTime);const e=this.playTime/this.videoDuration*100;this.playPercentage=Math.round(e),this.currentPauseIndex<this.pausePoints.length&&this.$refs.videoPlayer.currentTime>=this.pausePoints[this.currentPauseIndex]&&100!=this.playPercentage&&this.pauseVideoAndShowPopup()}},handlePause(){const e=this.$refs.videoPlayer;this.pausedTime=Math.floor(e.currentTime),console.log("暂停时间（秒）:",this.pausedTime)},handleSeeking(e){if(this.isInitialSeek)return;this.isUserInteraction=!0;const t=Math.abs(this.$refs.videoPlayer.currentTime-this.lastPlayedTime);t>.5&&(e.preventDefault(),this.$refs.videoPlayer.currentTime=this.lastPlayedTime,this.handleProgressClick(e)),this.isUserInteraction=!1},handleVideoEnded(){this.playPercentage=100,this.playTime=this.videoDuration;const e={classId:this.classId,playTime:this.pausedTime||this.playTime||this.videoDuration,playPersent:1};console.log("视频播放完成，提交数据:",e),(0,a.sC)(e).then((e=>{200==e.code?(this.$message.success("视频学习完成，提交成功！"),this.$router.go(-1)):this.$message.error(e.msg)}))},handleFullscreenChange(){const e=this.$refs.videoPlayer;document.fullscreenElement===e?e.classList.add("hide-progress"):e.classList.remove("hide-progress")},pauseVideoAndShowPopup(){this.$refs.videoPlayer.pause(),this.isPaused=!0,this.showPopup=!0,this.refreshCode(),this.userInput=""},handlePopupConfirm(){this.showPopup=!1,this.isPaused=!1,this.$refs.videoPlayer.play(),this.currentPauseIndex++}}},o=r,l=s(1656),c=(0,l.A)(o,i,n,!1,null,"1be92646",null),u=c.exports},5200:function(e,t,s){s.d(t,{sC:function(){return P},vK:function(){return p},jv:function(){return g},OK:function(){return E},pP:function(){return y},Fw:function(){return v},Ny:function(){return S},Qh:function(){return D},yI:function(){return k},dH:function(){return T},GA:function(){return h},bk:function(){return C},Fv:function(){return B},oA:function(){return m},Ie:function(){return f},cg:function(){return w},VA:function(){return d},cd:function(){return u},kp:function(){return A},lp:function(){return I},ip:function(){return F},f3:function(){return x},O5:function(){return b}});var i=s(4335),n=s(5130),a=s(4432),r=s(1052);console.log({NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_BASE_API,"process.env.VUE_APP_BASE_API");const o=i.A.create({baseURL:"/prod-api",timeout:1e4});function l(e,t={}){return o({url:e,method:"get",params:t})}function c(e,t={}){return o({url:e,method:"post",data:t})}o.interceptors.request.use((e=>((0,n.gf)()&&(e.headers["Authorization"]="Bearer "+(0,n.gf)()),e)),(e=>(console.log(e),Promise.reject(e)))),o.interceptors.response.use((e=>{const t=e.data;return 200!==t.code?((0,r.Message)({message:t.msg||"Error",type:"error",duration:5e3}),401!==t.code&&403!==t.code||((0,n.eF)(),a.A.push("/Login")),Promise.reject(new Error(t.msg||"Error"))):t}),(e=>(console.log("err"+e),(0,r.Message)({message:e.msg,type:"error",duration:5e3}),Promise.reject(e))));function u(e){return c("/api/member/register",e)}function h(e){return l("/api/member/getPhoneCode",e)}function d(e){return c("/api/member/pcLogin",e)}function p(e){return l("/api/banner/list",e)}function m(e){return l("/api/major/majorList",e)}function f(e){return l("/api/major/typeList",e)}function g(e){return l("/api/category/list",e)}function y(e){return l("/api/class/list",e)}function P(e){return c("/api/classhistory/update",e)}function v(e){return l("/api/classhistory/listv2",e)}function I(e){return l("/api/testhistory/list",e)}function C(e){return c("/api/testhistory/goTest",e)}function T(e){return l("/api/testquestion/getFirst",e)}function w(e){return l("/api/testquestion/getIndex",e)}function D(e){return c("/api/testquestion/submitAnswer",e)}function k(e){return l("/api/testquestion/getTotal",e)}function A(e){return c("/api/testhistory/end",e)}function b(e){return l("/api/member/getMemberInfo",e)}function E(e){return l("/api/certificate/list",e)}function x(e){return l("/api/member/updatePassword",e)}function S(e){return l("/api/certificate/getCretList",e)}function B(e){return l("/api/kcinfo/getInfo",e)}function F(e){return c("/api/member/updateMemberInfo",e)}},5845:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAAXNSR0IArs4c6QAAA1dJREFUWEfdmE1oE1EQx///TRO19tCDUA9Ku35AQQ8KFRUVWlTQWFFBxYMXUVDRg6CCTSqsNEkFBRXbg6h4ERQRFGzSi9KKCoIXDwoVbTfFilY99FBF02RHX9LExa9ms0mD5vSyO2/mx7ydeTND2H7GFXOqt4YHAGszBPUkZ9jfF2stIh9B9AHa7bFh6TR26V+yupldRGKDK4DUdYCzimU4Pz0yBHh2BPy1j5R8GkjBCFK9BCuySkQwQmIkP6XOpERQTaI6ZwuSJDyNCorqmHw18tLmmacpyzp6vHnuXWdmnEm3dfWv8ZBnQC7M7JShxDDnMxyLHybkdOYZ+hKfPi8xti8Ydaa+MGnjxvMq3/TKJyDq0+YFhxTQA0JWps+PMETQW5j6wnaRaBSBkfEHHzIcHfhQqmhyiqiij5GYKU43llI+BySQUY28WUpjf9JtiWwlWJX+bGweigf8ul4OoEjMNAHU/V9Aoai5icQ6gEPwWZeCa+YMF+pd1x6KRM12EMfsWf372hirjHcaTU1Jp2CugIyoOdNLeW2/ZmxgfdC0g8H1tfecQLkCartjNno86MlmdhDvADTaAQS4LqmKI60bZ7/JB6x4QEBvwK83hbsGdlLjKQAzbRfmKIStwQ36uYmgig6kDBq3zGrvFLQTsge2quG7B/cF1usX/gZVEqCswVC0v4HUzhNYlrmf8Djo15eXDSgSNZcKpYNgwzjE04BfXzzpQMadFzO8Fd52CvfYjRNsbfHXhScNKDEtvtb3pW63WDhprwIBSQLa2cQ0s2Wi3FTEb0heCTBiO57xbMCHsJL7g83znk0UYeq9KyCVGH3E2z8YeieWHA02z7maD0hWxhWQUhLujl+kqPDOZZ0kwI7EV5wwtuiOGwPXQEZPT4X3q75XE2lQ3YlYqcv5Hs/vPOcayMlx5CP7bwCpEhZSnhIW/H0Jm493Sy7DcGzgA1GaoYJTeoF8/KVRTCZx36kiN/KahysICWUuYtUolrmV9k6vfEBiURpItdI/DxtE5Bk0zyGnZahTL4W7B1fDsk5nYXLDBqUo1N2/UhP22AuryRzHqIvYAle1+vXHuYHVONS1cgysLHCbglHOyQGpPz9GetgMWPWlij4VTYDWB5GbY+9xwT7S+wYvTwZemmMr0wAAAABJRU5ErkJggg=="}}]);